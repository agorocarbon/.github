name: Run Security Scan and Post to PR
on:
  pull_request:
    types:
      - opened
      - synchronize
  pull_request_target:
    types:
      - closed

jobs:
  name: Scan Image
  runs-on: ubuntu-latest
  steps:
    - name: Post Scan Results to PR
      if: input.PULL_REQUEST
      uses: actions/github-script@v5.0.0
      env:
        SCAN: ${{ steps.package.outputs.content }}
        RESULT: ${{ steps.security-scan.outcome }}
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: process.env.SCAN
          })
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ["Security:".concat(process.env.RESULT)]
          })
